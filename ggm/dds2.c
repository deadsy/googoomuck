//-----------------------------------------------------------------------------
/*

DDS Lookup Table Based Oscillators

*/
//-----------------------------------------------------------------------------

#include <math.h>

#include "ggm.h"

#define DEBUG
#include "logging.h"

//-----------------------------------------------------------------------------

// frequency to x scaling (xrange/fs)
#define DDS_FSCALE ((float)(1ULL << 32) / AUDIO_FS)

//-----------------------------------------------------------------------------

// generated by ./scripts/lut.py
#define TABLE_BITS (7U)
static const uint32_t COS_TABLE_data[1U << (TABLE_BITS + 1)] = {
	0x3f800000U, 0xba9de1c8U, 0x3f7fb10fU, 0xbb6ca1fdU, 0x3f7ec46dU, 0xbbc4e093U, 0x3f7d3aacU, 0xbc097b5eU,
	0x3f7b14beU, 0xbc3031a9U, 0x3f7853f8U, 0xbc567b4aU, 0x3f74fa0bU, 0xbc7c40a4U, 0x3f710908U, 0xbc90b536U,
	0x3f6c835eU, 0xbca2f0dbU, 0x3f676bd8U, 0xbcb4c803U, 0x3f61c598U, 0xbcc62facU, 0x3f5b941aU, 0xbcd71d1cU,
	0x3f54db31U, 0xbce785e1U, 0x3f4d9f02U, 0xbcf75fddU, 0x3f45e403U, 0xbd0350a4U, 0x3f3daef9U, 0xbd0aa05eU,
	0x3f3504f3U, 0xbd119a99U, 0x3f2beb4aU, 0xbd183b08U, 0x3f226799U, 0xbd1e7d94U, 0x3f187fc0U, 0xbd245e62U,
	0x3f0e39daU, 0xbd29d9d0U, 0x3f039c3dU, 0xbd2eec7fU, 0x3ef15aeaU, 0xbd33934cU, 0x3edae880U, 0xbd37cb59U,
	0x3ec3ef15U, 0xbd3b920cU, 0x3eac7cd4U, 0xbd3ee512U, 0x3e94a031U, 0xbd41c25cU, 0x3e78cfccU, 0xbd442828U,
	0x3e47c5c2U, 0xbd4614faU, 0x3e164083U, 0xbd4787a2U, 0x3dc8bd36U, 0xbd487f3cU, 0x3d48fb30U, 0xbd48fb30U,
	0x248d3132U, 0xbd48fb30U, 0xbd48fb30U, 0xbd487f3cU, 0xbdc8bd36U, 0xbd4787a2U, 0xbe164083U, 0xbd4614faU,
	0xbe47c5c2U, 0xbd442828U, 0xbe78cfccU, 0xbd41c25cU, 0xbe94a031U, 0xbd3ee512U, 0xbeac7cd4U, 0xbd3b920cU,
	0xbec3ef15U, 0xbd37cb59U, 0xbedae880U, 0xbd33934cU, 0xbef15aeaU, 0xbd2eec7fU, 0xbf039c3dU, 0xbd29d9d0U,
	0xbf0e39daU, 0xbd245e62U, 0xbf187fc0U, 0xbd1e7d94U, 0xbf226799U, 0xbd183b08U, 0xbf2beb4aU, 0xbd119a99U,
	0xbf3504f3U, 0xbd0aa05eU, 0xbf3daef9U, 0xbd0350a4U, 0xbf45e403U, 0xbcf75fddU, 0xbf4d9f02U, 0xbce785e1U,
	0xbf54db31U, 0xbcd71d1cU, 0xbf5b941aU, 0xbcc62facU, 0xbf61c598U, 0xbcb4c803U, 0xbf676bd8U, 0xbca2f0dbU,
	0xbf6c835eU, 0xbc90b536U, 0xbf710908U, 0xbc7c40a4U, 0xbf74fa0bU, 0xbc567b4aU, 0xbf7853f8U, 0xbc3031a9U,
	0xbf7b14beU, 0xbc097b5eU, 0xbf7d3aacU, 0xbbc4e093U, 0xbf7ec46dU, 0xbb6ca1fdU, 0xbf7fb10fU, 0xba9de1c8U,
	0xbf800000U, 0x3a9de1c8U, 0xbf7fb10fU, 0x3b6ca1fdU, 0xbf7ec46dU, 0x3bc4e093U, 0xbf7d3aacU, 0x3c097b5eU,
	0xbf7b14beU, 0x3c3031a9U, 0xbf7853f8U, 0x3c567b4aU, 0xbf74fa0bU, 0x3c7c40a4U, 0xbf710908U, 0x3c90b536U,
	0xbf6c835eU, 0x3ca2f0dbU, 0xbf676bd8U, 0x3cb4c803U, 0xbf61c598U, 0x3cc62facU, 0xbf5b941aU, 0x3cd71d1cU,
	0xbf54db31U, 0x3ce785e1U, 0xbf4d9f02U, 0x3cf75fddU, 0xbf45e403U, 0x3d0350a4U, 0xbf3daef9U, 0x3d0aa05eU,
	0xbf3504f3U, 0x3d119a99U, 0xbf2beb4aU, 0x3d183b08U, 0xbf226799U, 0x3d1e7d94U, 0xbf187fc0U, 0x3d245e62U,
	0xbf0e39daU, 0x3d29d9d0U, 0xbf039c3dU, 0x3d2eec7fU, 0xbef15aeaU, 0x3d33934cU, 0xbedae880U, 0x3d37cb59U,
	0xbec3ef15U, 0x3d3b920cU, 0xbeac7cd4U, 0x3d3ee512U, 0xbe94a031U, 0x3d41c25cU, 0xbe78cfccU, 0x3d442828U,
	0xbe47c5c2U, 0x3d4614faU, 0xbe164083U, 0x3d4787a2U, 0xbdc8bd36U, 0x3d487f3cU, 0xbd48fb30U, 0x3d48fb30U,
	0xa553c9caU, 0x3d48fb30U, 0x3d48fb30U, 0x3d487f3cU, 0x3dc8bd36U, 0x3d4787a2U, 0x3e164083U, 0x3d4614faU,
	0x3e47c5c2U, 0x3d442828U, 0x3e78cfccU, 0x3d41c25cU, 0x3e94a031U, 0x3d3ee512U, 0x3eac7cd4U, 0x3d3b920cU,
	0x3ec3ef15U, 0x3d37cb59U, 0x3edae880U, 0x3d33934cU, 0x3ef15aeaU, 0x3d2eec7fU, 0x3f039c3dU, 0x3d29d9d0U,
	0x3f0e39daU, 0x3d245e62U, 0x3f187fc0U, 0x3d1e7d94U, 0x3f226799U, 0x3d183b08U, 0x3f2beb4aU, 0x3d119a99U,
	0x3f3504f3U, 0x3d0aa05eU, 0x3f3daef9U, 0x3d0350a4U, 0x3f45e403U, 0x3cf75fddU, 0x3f4d9f02U, 0x3ce785e1U,
	0x3f54db31U, 0x3cd71d1cU, 0x3f5b941aU, 0x3cc62facU, 0x3f61c598U, 0x3cb4c803U, 0x3f676bd8U, 0x3ca2f0dbU,
	0x3f6c835eU, 0x3c90b536U, 0x3f710908U, 0x3c7c40a4U, 0x3f74fa0bU, 0x3c567b4aU, 0x3f7853f8U, 0x3c3031a9U,
	0x3f7b14beU, 0x3c097b5eU, 0x3f7d3aacU, 0x3bc4e093U, 0x3f7ec46dU, 0x3b6ca1fdU, 0x3f7fb10fU, 0x3a9de1c8U,
};

#define TABLE_MASK ((1U << TABLE_BITS) - 1)
#define FRAC_BITS (32U - TABLE_BITS)
#define FRAC_MASK ((1U << FRAC_BITS) - 1)
#define FRAC_SCALE ((float)(1.f / (float)(1ULL << FRAC_BITS)))

//-----------------------------------------------------------------------------

//-----------------------------------------------------------------------------
